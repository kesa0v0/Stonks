services:
  # 1. 백엔드 API
  api:
    image: ghcr.io/kesa0v0/stonks-backend:latest
    container_name: stonks-api
    restart: always
    env_file: .env
    labels:
      - "com.centurylinklabs.watchtower.scope=auto-update"
    networks:
      - proxy

  # 2. 시세 수집 워커
  worker_data:
    image: ghcr.io/kesa0v0/stonks-backend:latest
    container_name: stonks-worker-data
    restart: always
    command: python -m backend.worker.data_feeder
    env_file: .env
    labels:
      - "com.centurylinklabs.watchtower.scope=auto-update"
    networks:
      - proxy

  # 3. 주문 체결 워커
  worker_trade:
    image: ghcr.io/kesa0v0/stonks-backend:latest
    container_name: stonks-worker-trade
    restart: always
    command: python -m backend.worker.trade_consumer
    env_file: .env
    labels:
      - "com.centurylinklabs.watchtower.scope=auto-update"
    networks:
      - proxy


networks:
  proxy:
    external: true